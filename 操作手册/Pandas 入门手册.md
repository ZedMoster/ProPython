# 十分钟入门 Pandas

![1_cxfqR8NAj8HGal8CVOZ7hg.png](https://cdn.nlark.com/yuque/0/2020/png/566404/1601964670763-f3cf3a01-4a9d-4851-99a0-4191acb7bf5b.png#align=left&display=inline&height=201&margin=%5Bobject%20Object%5D&name=1_cxfqR8NAj8HGal8CVOZ7hg.png&originHeight=201&originWidth=481&size=13931&status=done&style=none&width=481)
**十分钟(****删掉****小时****)入门Pandas****

---

## 导入Pandas
```python
import pandas as pd
```
[--------------------文档地址--------------------](https://www.pypandas.cn/deep/)

---

## 生成对象
### 创建 一维数据 对象
```python
import pandas as pd

d1 = pd.Series([1,2,3,4,5])
d2 = pd.Series(["a","b","c","d","e"])

# df = pd.DataFrame({"A":d1, "B":d2})

'''
0    1
1    2
2    3
3    4
4    5
dtype: int64
0    a
1    b
2    c
3    d
4    e
dtype: object
'''
```
### 创建 二维数据 对象
```python
import pandas as pd
import numpy as np

# 创建一个6行3列的随机数据
df = pd.DataFrame(np.random.randn(6,3),
                  index = [i for i in range(6)], columns = ["A", "B", "C"])

'''
          A         B         C
0  0.124665  1.354623 -0.701115
1  0.793852 -0.378799  0.502619
2 -0.343502 -0.153304  1.008549
3  1.047741  0.434839 -0.461387
4 -2.024051  0.270098  0.750414
5  0.756700  0.265707 -0.531845
'''
```

---

## 查看数据
### 查看 DataFrame 头部与尾部数据
```python
print(df)            # 查看全部数据
print("="*30)        # 分隔
print(df.head())     # 查看头部数据
print("="*30)        # 分隔
print(df.tail(3))    # 查看尾部数据

'''
          A         B         C
0  0.162626  0.743775 -0.043558
1  0.284162 -0.957022  1.618578
2  0.027395 -0.073792  1.730417
3  0.030660  2.162612  1.087933
4 -0.840563  0.011711 -1.582771
5 -1.129669 -1.069730 -1.274151
==============================
          A         B         C
0  0.162626  0.743775 -0.043558
1  0.284162 -0.957022  1.618578
2  0.027395 -0.073792  1.730417
3  0.030660  2.162612  1.087933
4 -0.840563  0.011711 -1.582771
==============================
          A         B         C
3  0.030660  2.162612  1.087933
4 -0.840563  0.011711 -1.582771
5 -1.129669 -1.069730 -1.274151
'''
```
### 查看 索引与列名
```python
print(df.index)     # 查看索引
print(df.columns)   # 查看列名

'''
Int64Index([0, 1, 2, 3, 4, 5], dtype='int64')
Index(['A', 'B', 'C'], dtype='object')
'''
```
### 快速查看数据的 统计摘要
```python
print(df.describe())   # 数据的统计摘要

'''
               A          B          C
count  10.000000  10.000000  10.000000
mean   -0.134164   0.066692  -0.623249
std     0.972375   1.050455   0.807784
min    -1.643474  -1.460358  -1.860893
25%    -0.709000  -0.225956  -1.223937
50%    -0.300770  -0.065260  -0.560801
75%     0.403706   0.283554  -0.120445
max     1.663865   2.175142   0.768465
'''
```
### 转置数据
```python
print(df)
print("="*30)
print(df.T)

'''
          A         B         C
0  1.090855 -1.072805  0.184583
1 -0.868626  0.318964 -0.121629
2 -0.791555  0.260809 -0.710310
3 -1.929772 -0.051195 -0.728330
4  2.554131  0.498501  2.133360
5 -0.823963 -1.090279 -0.522702
==============================
          0         1         2         3         4         5
A  1.090855 -0.868626 -0.791555 -1.929772  2.554131 -0.823963
B -1.072805  0.318964  0.260809 -0.051195  0.498501 -1.090279
C  0.184583 -0.121629 -0.710310 -0.728330  2.133360 -0.522702
'''
```
### 按轴排序
```python
print(df)
print("="*30)
# axis: 0 按行 1 按列  ascending: False 不改变源数据 True 改变源数据
print(df.sort_index(axis=1, ascending=False))  

'''
          A         B         C
0  2.155336 -0.434339 -0.090391
1  0.890209  0.129525  1.179782
2  1.220253  1.303012 -0.698433
3 -0.804471  0.224135 -0.703521
4 -1.253433 -1.146150 -0.735121
5 -0.670339 -1.742963  1.990105
==============================
          C         B         A
0 -0.090391 -0.434339  2.155336
1  1.179782  0.129525  0.890209
2 -0.698433  1.303012  1.220253
3 -0.703521  0.224135 -0.804471
4 -0.735121 -1.146150 -1.253433
5  1.990105 -1.742963 -0.670339
'''
```
### 按值排序
```python
print(df)
print("="*30)
print(df.sort_values(by="A"))  # 按列名所对应的值

'''
          A         B         C
0 -0.949729  0.405278  0.538712
1 -0.064786  1.980200 -0.487046
2 -0.399375  2.208867 -0.220238
3  2.146529 -1.066433 -1.176879
4 -0.898716 -2.105429 -0.558320
5  2.259551  0.161280 -0.290100
==============================
          A         B         C
0 -0.949729  0.405278  0.538712
4 -0.898716 -2.105429 -0.558320
2 -0.399375  2.208867 -0.220238
1 -0.064786  1.980200 -0.487046
3  2.146529 -1.066433 -1.176879
5  2.259551  0.161280 -0.290100
'''
```

---

## 选择数据
**推荐使用**：优化过的 **Pandas **数据访问方法：**.at**、**.****iat**、**.l****oc**** **和** .iloc**。
### 获取数据
获取单列，产生 **Series**。与 **df.A** 等效
```python
print(df)
print("="*30)
print(df["A"])
# print(df.A)

'''
          A         B         C
0 -3.889165  0.058995 -0.131490
1  0.214254  0.753761 -0.406589
2 -0.321746  0.337223  1.209453
3 -0.096389  0.656442  1.016707
4 -0.496134 -0.798966  0.425654
5  0.278245 -0.705807  0.986345
==============================
0   -3.889165
1    0.214254
2   -0.321746
3   -0.096389
4   -0.496134
5    0.278245
Name: A, dtype: float64
'''
```
用[ ] 切片行
```python
print(df)
print("="*30)
print(df[2:4])   # 第2行至第4行，左闭右开

'''
          A         B         C
0 -0.364004  0.148870 -0.330680
1 -0.572930 -1.423234  1.984326
2 -1.996496  0.120526 -2.829968
3  0.406163  0.824016  0.957999
4 -1.215831 -1.298448  0.947810
5 -0.511757  1.180600  0.913132
==============================
          A         B         C
2 -1.996496  0.120526 -2.829968
3  0.406163  0.824016  0.957999
'''
```
### 按标签选择
用标签提取一行数据
```python
print(df)
print("="*30)
print(df.loc[df.index[0]])    # 索引为提取行数的索引

'''
          A         B         C
0  0.339023  0.661502  0.824986
1  0.619245  0.474774 -0.055600
2  1.015228 -0.355425 -0.444053
3 -0.424160 -0.761022  0.024026
4  0.932760  0.666029 -0.203720
5 -1.002828  0.209472 -1.442866
==============================
A    0.339023
B    0.661502
C    0.824986
Name: 0, dtype: float64
'''
```
用标签选择多列数据
```python
print(df)
print("="*30)
print(df.loc[:, ['A', 'B']])   # : 提取所有的行  列名为 A B 的列

'''
          A         B         C
0 -0.060654 -0.813041 -1.073970
1 -0.851160  1.043976  0.194183
2  0.264642 -0.331834 -0.193718
3  0.803170  2.130145  0.244753
4  1.028380  1.088563 -1.176200
5  0.824463  0.115124 -0.603710
==============================
          A         B
0 -0.060654 -0.813041
1 -0.851160  1.043976
2  0.264642 -0.331834
3  0.803170  2.130145
4  1.028380  1.088563
5  0.824463  0.115124
'''
```
用标签切片，包含行与列结束点
```python
print(df)
print("="*30)
print(df.loc[2:4, ['A', 'B']])   # : 提取2-4行  列名为 A B 的列

'''
          A         B         C
0  1.341213  1.374567  0.896175
1 -1.432347 -1.498885  0.897229
2 -0.169359 -0.079813  0.778938
3  0.393801  0.451041 -0.689613
4 -1.103175  1.342899 -0.402991
5  0.742279 -0.119841  1.114146
==============================
          A         B
2 -0.169359 -0.079813
3  0.393801  0.451041
'''
```
提取标量值
```python
print(df)
print("="*30)
print(df.loc[0, 'A'])   # 按行列名提取值
# print(df.at[0, 'A'])

'''
          A         B         C
0  1.046345  1.010179 -0.352825
1 -0.409664  1.269217  0.393418
2  0.059705 -1.613766  0.560100
3 -1.070312 -1.936424  1.092546
4  0.237776  1.716479  0.188743
5 -0.321937  1.261209 -0.169163
==============================
1.04634487598175
'''
```
### 按位置选择
用整数位置选择
```python
print(df)
print("="*30)
print(df.iloc[1])    # 行位置进行选择

'''
          A         B         C
0  0.872330  0.687903  0.159091
1  0.829951 -1.186121  0.955721
2 -0.641111  1.725069  0.439762
3 -0.353691  1.285310 -1.207174
4 -2.075890 -0.105968  0.072471
5  1.347517 -0.675439  1.083256
==============================
A    0.829951
B   -1.186121
C    0.955721
Name: 1, dtype: float64
'''
```
类似 NumPy / Python，用整数切片
```python
print(df)
print("="*30)
print(df.iloc[3:5, 0:2])   # 切片选择

'''
          A         B         C
0  1.326371  0.416501 -0.848363
1 -0.112608 -0.330069 -1.758926
2 -0.783527  1.840435 -1.879246
3 -1.322841  0.379742  0.861523
4 -0.650409  2.086843  0.781831
5  2.226036 -1.644519 -0.401621
==============================
          A         B
3 -1.322841  0.379742
4 -0.650409  2.086843
'''
```
类似 NumPy / Python，用整数列表按位置切片
```python
print(df)
print("="*30)
print(df.iloc[[1, 2, 4], [0, 2]])   # 按位置

'''
          A         B         C
0 -0.097128  0.610125 -2.352895
1  0.649887  0.805659  0.090565
2  2.301369  0.795259 -0.413643
3  0.492440  1.282051 -1.398503
4 -0.470341  0.998427 -0.081993
5 -0.959278 -0.810422 -1.229398
==============================
          A         C
1  0.649887  0.090565
2  2.301369 -0.413643
4 -0.470341 -0.081993
'''
```
整行切片
```python
print(df)
print("="*30)
print(df.iloc[1:3, :])   # 整行切片

'''
          A         B         C
0 -0.153717 -0.106818 -0.172407
1 -0.283473 -0.683112 -0.750459
2 -1.485220  0.992581 -0.021852
3  0.245505 -1.018984  0.165750
4  0.777344 -0.746399  0.870930
5 -0.984809  2.206306  0.940896
==============================
          A         B         C
1 -0.283473 -0.683112 -0.750459
2 -1.485220  0.992581 -0.021852
'''
```
整列切片
```python
print(df)
print("="*30)
print(df.iloc[:, 1:3])   # 整列切片

'''
          A         B         C
0 -1.993272  1.161443  0.352810
1 -0.377859 -1.122316 -0.952971
2  0.392742  0.366656 -1.719720
3 -1.132892  1.721778  1.413876
4  0.846929 -0.397196  0.722770
5 -1.910569  0.215684  1.384120
==============================
          B         C
0  1.161443  0.352810
1 -1.122316 -0.952971
2  0.366656 -1.719720
3  1.721778  1.413876
4 -0.397196  0.722770
5  0.215684  1.384120
'''
```
提取值
```python
print(df)
print("="*30)
print(df.iloc[1, 1])   # 提取指定行列位置单元格的值
# print(df.iat[1,1])

'''
          A         B         C
0  0.075752  0.842907 -2.969243
1 -0.253084  0.069218  1.421668
2  0.671382  0.187895 -0.062780
3 -0.544736 -2.225326 -1.944038
4 -0.542584 -0.391144  0.145839
5  0.615728 -0.719422 -0.087461
==============================
0.06921757818689403
'''
```
### 布尔索引
用单列的值选择数据
```python
print(df)
print("="*30)
print(df[df.A > 0])

'''
          A         B         C
0  0.225120  0.312929  1.179228
1 -0.357687  1.709017  1.623291
2  0.278348 -1.132671  1.207691
3 -2.523049  0.227406 -0.360994
4 -0.157327 -0.292324 -0.197861
5 -0.708942  1.225583  0.281490
==============================
          A         B         C
0  0.225120  0.312929  1.179228
2  0.278348 -1.132671  1.207691
'''
```
选择 DataFrame 里满足条件的值
```python
print(df)
print("="*30)
print(df[df > 0])

'''
          A         B         C
0  0.456279 -1.338378 -0.116922
1 -1.835649  1.514987 -0.862178
2  0.515765  1.064303  0.717328
3  1.485883  1.320943  0.977202
4  1.033369 -0.980634 -1.702996
5  0.385172  0.056046  0.784007
==============================
          A         B         C
0  0.456279       NaN       NaN
1       NaN  1.514987       NaN
2  0.515765  1.064303  0.717328
3  1.485883  1.320943  0.977202
4  1.033369       NaN       NaN
5  0.385172  0.056046  0.784007
'''
```
用 **isin() **筛选
```python
# 添加辅助列
df['D'] = ['one', 'one', 'two', 'three', 'four', 'three']

print(df)
print("="*30)
print(df[df['D'].isin(['two', 'four'])])

'''
          A         B         C      D
0 -0.282657 -1.393703  0.875241    one
1 -0.276764 -1.399960 -0.028655    one
2  1.611027  1.376589  0.043859    two
3 -0.360664 -0.490467  0.489825  three
4  0.218109  1.323599 -0.541452   four
5  0.307106  0.358602 -0.751541  three
==============================
          A         B         C     D
2  1.611027  1.376589  0.043859   two
4  0.218109  1.323599 -0.541452  four
'''
```
### 赋值
用索引自动对齐新增列的数据
```python
# 增列的数据
s = pd.Series([1, 2, 3, 4, 5, 6], index= [i for i in range(6)])
# s = pd.Series([1, 2, 3, 4], index= [i for i in range(4)])

print(df)
print("="*30)
df["D"] = s
print(df)

'''
          A         B         C
0  1.541004 -0.621590  0.542895
1  0.685524  1.112586 -0.224701
2 -0.531432  1.739056 -1.160524
3  0.220122 -0.507556  0.289801
4  0.791843 -0.278992 -1.662583
5  0.494893 -1.428766 -1.913229
==============================
          A         B         C  D
0  1.541004 -0.621590  0.542895  1
1  0.685524  1.112586 -0.224701  2
2 -0.531432  1.739056 -1.160524  3
3  0.220122 -0.507556  0.289801  4
4  0.791843 -0.278992 -1.662583  5
5  0.494893 -1.428766 -1.913229  6
'''
```
按标签赋值
```python
print(df)
print("="*30)
df.at[df.index[0], "A"] = 0
print(df)

'''
          A         B         C
0 -0.896498 -1.134660 -1.701185
1 -0.495562 -0.039068 -0.136614
2  0.156827  0.028074  0.051109
3  1.300580 -0.404301  0.557794
4  0.648387 -0.110362  0.682723
5  0.627710  1.071018 -0.375658
==============================
          A         B         C
0  0.000000 -1.134660 -1.701185
1 -0.495562 -0.039068 -0.136614
2  0.156827  0.028074  0.051109
3  1.300580 -0.404301  0.557794
4  0.648387 -0.110362  0.682723
5  0.627710  1.071018 -0.375658
'''
```
按位置赋值
```python
print(df)
print("="*30)
df.iat[0,0] = 0
print(df)

'''
          A         B         C
0 -0.229924 -1.556863  1.382965
1  1.078071 -1.616441 -0.906143
2 -0.998971  0.095389  0.307799
3 -1.363223  1.481546 -0.640917
4  0.797193 -1.737114  0.529679
5  0.293870  0.813873 -1.296403
==============================
          A         B         C
0  0.000000 -1.556863  1.382965
1  1.078071 -1.616441 -0.906143
2 -0.998971  0.095389  0.307799
3 -1.363223  1.481546 -0.640917
4  0.797193 -1.737114  0.529679
5  0.293870  0.813873 -1.296403
'''
```
用 **where **条件赋值
```python
print(df)
print("="*30)
df[df < 0] = -df
print(df)

'''
          A         B         C
0  0.283596  0.338517 -0.051221
1  1.504277 -0.642568 -2.094442
2 -1.054536  0.605670  0.345182
3 -0.316435 -0.360860 -0.623269
4  0.893348 -0.417538 -1.249896
5  1.234152  0.341326  1.208369
==============================
          A         B         C
0  0.283596  0.338517  0.051221
1  1.504277  0.642568  2.094442
2  1.054536  0.605670  0.345182
3  0.316435  0.360860  0.623269
4  0.893348  0.417538  1.249896
5  1.234152  0.341326  1.208369
'''
```

---

## 缺失值
Pandas 主要用 **np.nan** 表示缺失数据。
### 删除所有含缺失值的行
```python
s = pd.Series([1, 2, 3], index= [i for i in range(1,4)])
df["D"] = s

print(df)
print("="*30)
print(df.dropna(how='any'))

'''
          A         B         C    D
0 -0.543853  1.078289  1.605213  NaN
1  0.153537 -0.710202  0.759139  1.0
2 -1.274189 -1.197363 -0.827345  2.0
3 -0.842268 -0.461013 -0.506485  3.0
4  1.244591  0.628373  0.222035  NaN
5 -1.022085  2.114092 -1.020721  NaN
==============================
          A         B         C    D
1  0.153537 -0.710202  0.759139  1.0
2 -1.274189 -1.197363 -0.827345  2.0
3 -0.842268 -0.461013 -0.506485  3.0
'''
```
### 填充缺失值
```python
s = pd.Series([1, 2, 3], index= [i for i in range(1,4)])
df["D"] = s

print(df)
print("="*30)
print(df.fillna(value=0))

'''
          A         B         C    D
0  0.320348 -0.155423 -1.706578  NaN
1 -1.117155 -1.388033 -0.112940  1.0
2  1.472523 -1.621894  0.281751  2.0
3 -1.273164 -0.487470 -0.156216  3.0
4  0.323109  1.527510  0.648772  NaN
5 -0.297837 -2.281177  1.050784  NaN
==============================
          A         B         C    D
0  0.320348 -0.155423 -1.706578  0.0
1 -1.117155 -1.388033 -0.112940  1.0
2  1.472523 -1.621894  0.281751  2.0
3 -1.273164 -0.487470 -0.156216  3.0
4  0.323109  1.527510  0.648772  0.0
5 -0.297837 -2.281177  1.050784  0.0
'''
```
### 提取 NaN 值的布尔掩码
```python
s = pd.Series([1, 2, 3], index= [i for i in range(1,4)])
df["D"] = s

print(df)
print("="*30)
print(df.isna())

'''
          A         B         C    D
0  0.462171 -0.212011  1.621004  NaN
1 -2.031842  1.020010 -0.346799  1.0
2  0.772598 -1.037917  0.252420  2.0
3 -0.995666 -0.464408 -0.319256  3.0
4 -1.564766  0.503919 -0.021231  NaN
5  0.598078 -0.400159 -0.112247  NaN
==============================
       A      B      C      D
0  False  False  False   True
1  False  False  False  False
2  False  False  False  False
3  False  False  False  False
4  False  False  False   True
5  False  False  False   True
'''
```

---

## 运算
### 统计
一般情况下，运算时**排除**缺失值。
**描述性统计**
```python
s = pd.Series([1, 2, 3], index= [i for i in range(1,4)])
df["D"] = s

print(df)
print("="*30)
print(df.mean())

'''
          A         B         C    D
0 -1.703692 -0.575941  0.628585  NaN
1  0.916258  0.854553  0.380848  1.0
2  0.492740 -0.523946  1.288998  2.0
3  0.533275 -0.607054 -2.210509  3.0
4 -1.286734  1.610702  0.775895  NaN
5  1.206607 -1.991650  2.387589  NaN
==============================
A    0.026409
B   -0.205556
C    0.541901
D    2.000000
dtype: float64
'''
```
在另一个轴(即，行)上执行同样的操作
```python
s = pd.Series([1, 2, 3], index= [i for i in range(1,4)])
df["D"] = s

print(df)
print("="*30)
print(df.mean(1))

'''
          A         B         C    D
0  0.128729 -0.642457 -1.474499  NaN
1  0.021186 -0.041340 -2.857500  1.0
2  0.400155  2.757253 -1.097531  2.0
3 -0.753501  1.087295 -0.069450  3.0
4  0.159137  0.214257  0.319562  NaN
5  1.489170 -0.616156  1.099160  NaN
==============================
0   -0.662743
1   -0.469413
2    1.014969
3    0.816086
4    0.230985
5    0.657392
dtype: float64
'''
```
不同维度对象运算时，要先对齐。 此外，Pandas 自动沿指定维度偏移（空填充NaN）。
```python
s1 = pd.Series([1, 3, 5, np.nan, 6, 8], index=[i for i in range(6)])
s2 = pd.Series([1, 3, 5, np.nan, 6, 8], index=[i for i in range(6)]).shift(2)

print(s1)
print("="*30)
print(s2)

'''
0    1.0
1    3.0
2    5.0
3    NaN
4    6.0
5    8.0
dtype: float64
==============================
0    NaN
1    NaN
2    1.0
3    3.0
4    5.0
5    NaN
dtype: float64
'''
```
对不同维度的 pandas 对象按index进行减法操作
```python
s = pd.Series([1, 3, 5, np.nan, 6, 8], index=[i for i in range(6)]).shift(2)

print(df)
print("="*30)
print(df.sub(s, axis='index'))   # 对不同维度的 pandas 对象进行减法操作

'''
          A         B         C
0 -0.584577  1.600920  0.086218
1  0.618951  1.851896 -0.424703
2 -1.275505  0.841881  0.922940
3 -0.190054 -0.358825 -0.540433
4 -1.572596 -0.472747  2.342729
5  0.328756 -0.890938 -0.099436
==============================
          A         B         C
0       NaN       NaN       NaN
1       NaN       NaN       NaN
2 -2.275505 -0.158119 -0.077060
3 -3.190054 -3.358825 -3.540433
4 -6.572596 -5.472747 -2.657271
5       NaN       NaN       NaN
'''
```
### Apply 函数
**np.cumsum() **计算轴向元素累加和
```python
s = pd.Series([1, 3, 5, 7, np.nan, 9], index=[i for i in range(6)])
df["D"] = s

print(df)
print("="*30)
print(df.apply(np.cumsum))

'''
          A         B         C    D
0 -2.061076  0.933043  0.593438  1.0
1  0.521699  0.100992  0.803118  3.0
2 -0.648522  1.948277  0.424076  5.0
3  0.353591  0.956902  0.725868  7.0
4  0.015446  2.114823 -0.113994  NaN
5  0.187891 -0.402199 -0.408387  9.0
==============================
          A         B         C     D
0 -2.061076  0.933043  0.593438   1.0
1 -1.539376  1.034036  1.396556   4.0
2 -2.187898  2.982312  1.820633   9.0
3 -1.834308  3.939215  2.546501  16.0
4 -1.818861  6.054038  2.432507   NaN
5 -1.630970  5.651839  2.024119  25.0
'''
```
**lambda **计算列最大值与最小值差
```python
s = pd.Series([1, 3, 5, 7, np.nan, 9], index=[i for i in range(6)])
df["D"] = s

print(df)
print("="*30)
print(df.apply(lambda x: x.max() - x.min()))

'''
          A         B         C    D
0 -0.458813  0.887916 -1.148145  1.0
1 -0.641170 -0.508265  1.569428  3.0
2  2.144850 -0.914715  1.502805  5.0
3 -2.162331  0.916027 -0.552572  7.0
4 -0.715221  0.741209  1.283300  NaN
5 -0.952700  0.759135  0.839457  9.0
==============================
A    4.307181
B    1.830742
C    2.717572
D    8.000000
dtype: float64
'''
```
### 字符串方法
**Series **的 **str** 属性包含一组字符串处理功能
```python
s = pd.Series(['A', 'B', 'C', 'Aaba', 'Baca', np.nan, 'CABA', 'dog', 'cat'])
# print(s.str.upper())
print(s.str.lower())   # 字符串转小写

'''
0       a
1       b
2       c
3    aaba
4    baca
5     NaN
6    caba
7     dog
8     cat
dtype: object
'''
```

---

## 合并（Merge）
### 结合（Concat）
**Pandas **提供了多种将 **Series**、**DataFrame **对象组合在一起的功能，用索引与关联代数功能的多种设置逻辑可执行连接（**join**）与合并（**merge**）操作。
```python
# -*- coding:utf-8 -*-
# @Time      : 2020-10-05
# @Author    : xml

import pandas as pd
import numpy as np

df = pd.DataFrame(np.random.randn(10,3),
                  index = [i for i in range(10)], columns = ["A", "B", "C"])

# 分割为多组
pie = [df[:3],df[7:]]

print(df)
print("="*30)
print(pd.concat(pie))

'''
          A         B         C
0  1.165033 -0.384343  2.195076
1  1.103231  0.897121 -1.539638
2 -0.740862 -1.330342  0.758274
3 -0.989859 -0.129917 -1.821686
4  0.248147 -0.009504 -0.240990
5  0.465128  0.874807  0.397816
6  2.649065  2.967698  2.902726
7  0.902977  2.218083 -0.231896
8 -1.029878  0.252509 -0.499249
9  0.299016  0.748987 -2.134939
==============================
          A         B         C
0  1.165033 -0.384343  2.195076
1  1.103231  0.897121 -1.539638
2 -0.740862 -1.330342  0.758274
7  0.902977  2.218083 -0.231896
8 -1.029878  0.252509 -0.499249
9  0.299016  0.748987 -2.134939
'''
```
### 连接（join）
```python
# -*- coding:utf-8 -*-
# @Time      : 2020-10-05
# @Author    : xml

import pandas as pd
import numpy as np

# left = pd.DataFrame({'key': ['foo', 'foo'], 'leftVal': [1, 2]})
# right = pd.DataFrame({'key': ['foo', 'foo'], 'rightVal': [4, 5]})
#
# df = pd.merge(left, right, on='key')  # key 相同 计算方式：叉积
#
# print(left)
# print(right)
# print("="*30)
# print(df)

left = pd.DataFrame({'key': ['foo', 'bar'], 'lval': [1, 2]})
right = pd.DataFrame({'key': ['foo', 'bar'], 'rval': [4, 5]})

df = pd.merge(left, right, on='key')  # key 不相同 计算方式：交集

print(left)
print(right)
print("="*30)
print(df)

'''
   key  lval
0  foo     1
1  bar     2
   key  rval
0  foo     4
1  bar     5
==============================
   key  lval  rval
0  foo     1     4
1  bar     2     5
'''
```
### 追加（Append）
```python
# -*- coding:utf-8 -*-
# @Time      : 2020-10-05
# @Author    : xml

import pandas as pd
import numpy as np

df = pd.DataFrame(np.random.randn(3, 4), columns=['A', 'B', 'C', 'D'])

s = df.iloc[-1]

print(df)
print("="*30)
print(df.append(s, ignore_index=True))

'''
          A         B         C         D
0  0.611300 -0.800572 -0.353525 -1.236768
1  1.525472  0.664762 -0.801413 -0.047937
2 -1.012871  1.016602 -1.807150 -0.570177
==============================
          A         B         C         D
0  0.611300 -0.800572 -0.353525 -1.236768
1  1.525472  0.664762 -0.801413 -0.047937
2 -1.012871  1.016602 -1.807150 -0.570177
3 -1.012871  1.016602 -1.807150 -0.570177
'''
```

---

## 分组（Grouping）
**groupby**  指的是涵盖下列一项或多项步骤的处理流程：

- **分割**：按条件把数据分割成多组；
- **应用**：为每组单独应用函数；
- **组合**：将处理结果组合成一个数据结构。



先分组，再用** sum()**函数计算每组的汇总数据
```python
# -*- coding:utf-8 -*-
# @Time      : 2020-10-05
# @Author    : xml

import pandas as pd
import numpy as np

df = pd.DataFrame({
    'A': ['foo', 'bar', 'foo', 'bar', 'foo', 'bar', 'foo'],
    'B': ['one', 'one', 'two', 'three', 'two', 'two', 'three'],
    'C': np.random.randn(7),
    'D': np.random.randn(7) })

print(df)
print("="*30)
print(df.groupby('A').sum())

'''
     A      B         C         D
0  foo    one  1.308640 -0.023831
1  bar    one -1.076809 -0.489503
2  foo    two -0.905921  1.384916
3  bar  three -1.241199 -0.006680
4  foo    two  1.874379 -1.549396
5  bar    two -0.277820 -0.636638
6  foo  three  1.214788  0.946836
==============================
            C         D
A                      
bar -2.595828 -1.132822
foo  3.491886  0.758525
'''
```
多列分组后，生成多层索引，也可以应用 **sum() **函数
```python
df = pd.DataFrame({
    'A': ['foo', 'bar', 'foo', 'bar', 'foo', 'bar', 'foo'],
    'B': ['one', 'one', 'two', 'three', 'two', 'two', 'three'],
    'C': np.random.randn(7),
    'D': np.random.randn(7) })

print(df)
print("="*30)
print(df.groupby(['A', 'B']).sum())

'''
     A      B         C         D
0  foo    one -0.042610  0.422804
1  bar    one -0.784786  2.476076
2  foo    two  0.131051  0.137128
3  bar  three -0.859655 -0.854677
4  foo    two  0.032752 -0.437160
5  bar    two  0.150680  0.607142
6  foo  three  1.276175  1.193811
==============================
                  C         D
A   B                        
bar one   -0.784786  2.476076
    three -0.859655 -0.854677
    two    0.150680  0.607142
foo one   -0.042610  0.422804
    three  1.276175  1.193811
    two    0.163803 -0.300032
'''
```



---

## 重塑（Reshaping）
### 堆叠（Stack）
```python
# -*- coding:utf-8 -*-
# @Time      : 2020-10-05
# @Author    : xml

import pandas as pd
import numpy as np

tuples = list(zip(*[
    ['bar', 'bar', 'baz', 'baz','foo', 'foo', 'qux', 'qux'],
    ['one', 'two', 'one', 'two','one', 'two', 'one', 'two'] ]))

# 设置堆叠
index = pd.MultiIndex.from_tuples(tuples, names=['first', 'second'])

df = pd.DataFrame(np.random.randn(8, 2), index=index, columns=['A', 'B'])
print(df)

'''
                     A         B
first second                    
bar   one    -1.336275 -0.030989
      two     0.368196  0.130646
baz   one    -0.812696 -0.482284
      two     0.964527 -0.868157
foo   one     0.515658 -0.894977
      two    -0.576530 -0.778433
qux   one    -1.153507  1.761371
      two    -0.954842 -0.315546
'''
```
压缩后的 **DataFrame **或 **Series **具有多层索引， **stack()** 的逆操作是 **unstack()**，默认为拆叠最后一层
```python
tuples = list(zip(*[
    ['bar', 'bar', 'baz', 'baz','foo', 'foo', 'qux', 'qux'],
    ['one', 'two', 'one', 'two','one', 'two', 'one', 'two'] ]))

# 设置堆叠
index = pd.MultiIndex.from_tuples(tuples, names=['first', 'second'])

df = pd.DataFrame(np.random.randn(8, 2), index=index, columns=['A', 'B'])
stacked = df.stack()
print(stacked)
print("="*30)
print(stacked.unstack())
print("="*30)
print(stacked.unstack(1))
print("="*30)
print(stacked.unstack(0))

'''
first  second   
bar    one     A    1.045996
               B    0.605382
       two     A   -1.885341
               B    0.515791
baz    one     A    0.282474
               B    0.063214
       two     A   -2.581561
               B   -0.479922
foo    one     A   -0.343941
               B    0.450805
       two     A   -1.067748
               B    1.004922
qux    one     A   -1.413637
               B    2.494043
       two     A   -0.305369
               B   -0.317468
dtype: float64
==============================
                     A         B
first second                    
bar   one     1.045996  0.605382
      two    -1.885341  0.515791
baz   one     0.282474  0.063214
      two    -2.581561 -0.479922
foo   one    -0.343941  0.450805
      two    -1.067748  1.004922
qux   one    -1.413637  2.494043
      two    -0.305369 -0.317468
==============================
second        one       two
first                      
bar   A  1.045996 -1.885341
      B  0.605382  0.515791
baz   A  0.282474 -2.581561
      B  0.063214 -0.479922
foo   A -0.343941 -1.067748
      B  0.450805  1.004922
qux   A -1.413637 -0.305369
      B  2.494043 -0.317468
==============================
first          bar       baz       foo       qux
second                                          
one    A  1.045996  0.282474 -0.343941 -1.413637
       B  0.605382  0.063214  0.450805  2.494043
two    A -1.885341 -2.581561 -1.067748 -0.305369
       B  0.515791 -0.479922  1.004922 -0.317468
'''
```



---

## 数据透视表（Pivot Tables）
```python
# -*- coding:utf-8 -*-
# @Time      : 2020-10-05
# @Author    : xml

import pandas as pd
import numpy as np

df = pd.DataFrame({
    'A': ['one', 'one', 'two', 'three'] * 3,
    'B': ['A', 'B', 'C'] * 4,
    'C': ['foo', 'foo', 'foo', 'bar', 'bar', 'bar'] * 2,
    'D': np.random.randn(12) })


print(df)
print("="*30)
pt = pd.pivot_table(df, values='D', index=['A', 'B'], columns=['C'])
print(pt)
```
![pivot_table.jpg](https://cdn.nlark.com/yuque/0/2020/jpeg/566404/1584070444869-5aaa78f4-bdc6-49c6-87c0-1e7d1b3d8411.jpeg#align=left&display=inline&height=855&margin=%5Bobject%20Object%5D&name=pivot_table.jpg&originHeight=855&originWidth=648&size=100775&status=done&style=shadow&width=648)

---

## 类别型（Categoricals）
Pandas 的 DataFrame 里可以包含类别数据。

将 **grade **的原生数据转换为类别型数据
```python
df = pd.DataFrame({"id": [1, 2, 3, 4, 5, 6], "raw_grade": ['a', 'b', 'b', 'a', 'a', 'e']})

print(df)
print("="*30)
df["grade"] = df["raw_grade"].astype("category")
print(df["grade"])

'''
   id raw_grade
0   1         a
1   2         b
2   3         b
3   4         a
4   5         a
5   6         e
==============================
0    a
1    b
2    b
3    a
4    a
5    e
Name: grade, dtype: category
Categories (3, object): ['a', 'b', 'e']
'''
```



---

## 可视化
```python
# -*- coding:utf-8 -*-
# @Time      : 2020-10-05
# @Author    : xml

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

ts = pd.Series(np.random.randn(1000), index=pd.date_range('1/1/2020', periods=1000))

ts = ts.cumsum()
ts.plot()

plt.show()
```
![Figure_1.png](https://cdn.nlark.com/yuque/0/2020/png/566404/1601964062861-5ba324df-94e1-4d28-94ae-4aa1a6f97f05.png#align=left&display=inline&height=1321&margin=%5Bobject%20Object%5D&name=Figure_1.png&originHeight=1321&originWidth=2560&size=122746&status=done&style=shadow&width=2560)
DataFrame 的** plot() **方法可以快速绘制所有带标签的列
```python
# -*- coding:utf-8 -*-
# @Time      : 2020-10-05
# @Author    : xml

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

ts = pd.Series(np.random.randn(1000), index=pd.date_range('1/1/2020', periods=1000))

df = pd.DataFrame(np.random.randn(1000, 4), index=ts.index, columns=['A', 'B', 'C', 'D'])

df = df.cumsum()
plt.figure()
df.plot()
plt.legend(loc='best')

plt.show()
```
![Figure_2.png](https://cdn.nlark.com/yuque/0/2020/png/566404/1601964244039-819a76b0-9c55-414b-990a-1ad9b8118dbb.png#align=left&display=inline&height=1321&margin=%5Bobject%20Object%5D&name=Figure_2.png&originHeight=1321&originWidth=2560&size=329255&status=done&style=shadow&width=2560)

---

## 数据输入 / 输出
### CSV
写入 CSV 文件
```python
df.to_csv('output.csv')
```
读取 CSV 文件
```python
pd.read_csv('input.csv')
```
### Excel
写入 Excel 文件
```python
df.to_excel('output.xlsx', sheet_name='Sheet1')
```
读取 Excel 文件
```python
pd.read_excel('input.xlsx', 'Sheet1', index_col=None, na_values=['NA'])
```


