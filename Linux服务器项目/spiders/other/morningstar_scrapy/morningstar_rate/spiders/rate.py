# -*- coding: utf-8 -*-
import scrapy
import pymongo
import pandas as pd
from ..items import MorningstarRateItem
import datetime
import math

class RateSpider(scrapy.Spider):
    name = 'rate'
    # now = datetime.datetime.now()
    # strToday = str(now.strftime('%Y-%m-%d'))

    start_urls = ['http://cn.morningstar.com/quickrank/default.aspx']

    def parse(self, response):
        # 最大翻页数
        num = response.xpath('//*[@id="ctl00_cphMain_TotalResultLabel"]/text()').extract()[0]
        pages = math.ceil(int(num) / 25)

        # 测试数据
        # for page in range(1,3):
        for page in range(1, pages + 1):
            # 表单数据
            data = {
                '__EVENTTARGET': 'ctl00$cphMain$AspNetPager1',
                '__EVENTARGUMENT': str(page),
                'ctl00$cphMain$ddlPageSite': '25',
                '__LASTFOCUS': '',
                'ctl00$cphMain$txtFund': '基金名称',
                '__VIEWSTATE': '/wEPDwUJNzc4MTU2Nzg3DxYGHgpDdXJyZW50VGFiBQhzbmFwc2hvdB4JU29ydEZpbGVkBQ9TdGFyUmF0aW5nNVllYXIeB1NvcnREaXIFA0FTQxYCZg9kFgICAw9kFgJmD2QWGAIBDw8WAh4EVGV4dAUZ6K+E57qn5pel5pyf77yaMjAxOS0xMi0zMWRkAgIPDxYEHwMFGuafpeeci+acgOi/keaciOacq+ivhOe6pz4+HgdWaXNpYmxlZ2RkAgcPEA8WBh4NRGF0YVRleHRGaWVsZAUETmFtZR4ORGF0YVZhbHVlRmllbGQFAklkHgtfIURhdGFCb3VuZGdkEBWaARAtLeWfuumHkeWFrOWPuC0tACTlronkv6Hln7rph5HnrqHnkIbmnInpmZDotKPku7vlhazlj7ge5a6d55uI5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4JOWMl+S/oeeRnuS4sOWfuumHkeeuoeeQhuaciemZkOWFrOWPuB7ljZrpgZPln7rph5HnrqHnkIbmnInpmZDlhazlj7ge5Y2a5pe25Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4HuWNmui/nOWfuumHkeeuoeeQhuaciemZkOWFrOWPuCrmuKTmtbfmsYfph5Hor4HliLjotYTkuqfnrqHnkIbmnInpmZDlhazlj7ge6LSi6YCa5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4JOi0oumAmuivgeWIuOi1hOS6p+euoeeQhuaciemZkOWFrOWPuB7plb/lronln7rph5HnrqHnkIbmnInpmZDlhazlj7ge6ZW/5Z+O5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4LOmVv+axn+ivgeWIuCjkuIrmtbcp6LWE5Lqn566h55CG5pyJ6ZmQ5YWs5Y+4HumVv+ebm+WfuumHkeeuoeeQhuaciemZkOWFrOWPuCTplb/kv6Hln7rph5HnrqHnkIbmnInpmZDotKPku7vlhazlj7gk5Yib6YeR5ZCI5L+h5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4Hua3s+WOmuWfuumHkeeuoeeQhuaciemZkOWFrOWPuB7lpKfmiJDln7rph5HnrqHnkIbmnInpmZDlhazlj7ge5b636YKm5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4J+S4nOaWuemYv+WwlOazleWfuumHkeeuoeeQhuaciemZkOWFrOWPuCrkuJzmlrnmsYfnkIbotYTkuqfnrqHnkIbpppnmuK/mnInpmZDlhazlj7gk5Lic5pa55Z+66YeR566h55CG5pyJ6ZmQ6LSj5Lu75YWs5Y+4JOS4nOa1t+WfuumHkeeuoeeQhuaciemZkOi0o+S7u+WFrOWPuB7kuJzlkLTln7rph5HnrqHnkIbmnInpmZDlhazlj7ge5Lic5YW06K+B5Yi46IKh5Lu95pyJ6ZmQ5YWs5Y+4JOS4nOS6muiBlOS4sOaKlei1hOeuoeeQhuaciemZkOWFrOWPuCTmlrnmraPlr4zpgqbln7rph5HnrqHnkIbmnInpmZDlhazlj7ge6JyC5bei5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4IeWvjOWuiei+vuWfuumHkeeuoeeQhuaciemZkOWFrOWPuB7lr4zlm73ln7rph5HnrqHnkIbmnInpmZDlhazlj7ge5a+M6I2j5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4HuagvOael+WfuumHkeeuoeeQhuaciemZkOWFrOWPuCTlt6Xpk7bnkZ7kv6Hln7rph5HnrqHnkIbmnInpmZDlhazlj7gn5YWJ5aSn5L+d5b635L+h5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4HuW5v+WPkeWfuumHkeeuoeeQhuaciemZkOWFrOWPuB7lm73pg73or4HliLjogqHku73mnInpmZDlhazlj7gq5Zu95rW35a+M5YWw5YWL5p6X5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4HuWbvemHkeWfuumHkeeuoeeQhuaciemZkOWFrOWPuCrlm73lvIDms7Dlr4zln7rph5HnrqHnkIbmnInpmZDotKPku7vlhazlj7gh5Zu96IGU5a6J5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4HuWbveiejeWfuumHkeeuoeeQhuaciemZkOWFrOWPuCTlm73lr7/lronkv53ln7rph5HnrqHnkIbmnInpmZDlhazlj7ge5Zu95rOw5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4JOWbveaKleeRnumTtuWfuumHkeeuoeeQhuaciemZkOWFrOWPuCHmtbflr4zpgJrln7rph5HnrqHnkIbmnInpmZDlhazlj7gk5ZCI54Wm5pm66L+c5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4JOaBkueUn+WJjea1t+WfuumHkeeuoeeQhuaciemZkOWFrOWPuB7mgZLnlJ/mipXotYTnrqHnkIbmnInpmZDlhazlj7ge5oGS6LaK5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4JOW8mOavhei/nOaWueWfuumHkeeuoeeQhuaciemZkOWFrOWPuCTnuqLloZTnuqLlnJ/ln7rph5HnrqHnkIbmnInpmZDlhazlj7gk57qi5Zyf5Yib5paw5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4Huazk+W+t+WfuumHkeeuoeeQhuaciemZkOWFrOWPuB7ljY7lronln7rph5HnrqHnkIbmnInpmZDlhazlj7ge5Y2O5a6d5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4JOWNjuWuuOacquadpeWfuumHkeeuoeeQhuaciemZkOWFrOWPuB7ljY7lr4zln7rph5HnrqHnkIbmnInpmZDlhazlj7ge5Y2O6J6N5Z+66YeR6IKh5Lu95pyJ6ZmQ5YWs5Y+4JOWNjua2puWFg+Wkp+WfuumHkeeuoeeQhuaciemZkOWFrOWPuB7ljY7llYbln7rph5HnrqHnkIbmnInpmZDlhazlj7gk5Y2O5rOw5p+P55Ge5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4JOWNjuazsOS/neWFtOWfuumHkeeuoeeQhuaciemZkOWFrOWPuDDljY7ms7Dor4HliLjvvIjkuIrmtbfvvInotYTkuqfnrqHnkIbmnInpmZDlhazlj7ge5Y2O5aSP5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4JOaxh+WuieWfuumHkeeuoeeQhuaciemZkOi0o+S7u+WFrOWPuCTmsYfkuLDmmYvkv6Hln7rph5HnrqHnkIbmnInpmZDlhazlj7gq5rGH5Liw5oqV6LWE5Z+66YeR77yI6aaZ5riv77yJ5pyJ6ZmQ5YWs5Y+4J+axh+a3u+WvjOWfuumHkeeuoeeQhuiCoeS7veaciemZkOWFrOWPuCTmg6DnkIbln7rph5HnrqHnkIbpppnmuK/mnInpmZDlhazlj7gk5oOg5Y2H5Z+66YeR566h55CG5pyJ6ZmQ6LSj5Lu75YWs5Y+4HuWYieWQiOWfuumHkeeuoeeQhuaciemZkOWFrOWPuB7lmInlrp7ln7rph5HnrqHnkIbmnInpmZDlhazlj7gk5bu65L+h5Z+66YeR566h55CG5pyJ6ZmQ6LSj5Lu75YWs5Y+4JOW7uumTtuWbvemZhei1hOS6p+euoeeQhuaciemZkOWFrOWPuB7msZ/kv6Hln7rph5HnrqHnkIbmnInpmZDlhazlj7gn5Lqk6ZO25pa9572X5b635Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4HumHkeS/oeWfuumHkeeuoeeQhuaciemZkOWFrOWPuB7ph5HpubDln7rph5HnrqHnkIbmnInpmZDlhazlj7gk6YeR5YWD6aG65a6J5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4JOaZr+mhuumVv+WfjuWfuumHkeeuoeeQhuaciemZkOWFrOWPuB7kuZ3ms7Dln7rph5HnrqHnkIbmnInpmZDlhazlj7ge5Yev55+z5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4JOawkeeUn+WKoOmTtuWfuumHkeeuoeeQhuaciemZkOWFrOWPuCTmkanmoLnln7rph5HvvIjkuprmtLLvvInmnInpmZDlhazlj7gt5pGp5qC55aOr5Li55Yip5Y2O6ZGr5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4JOWNl+aWueWfuumHkeeuoeeQhuiCoeS7veaciemZkOWFrOWPuB7ljZfljY7ln7rph5HnrqHnkIbmnInpmZDlhazlj7gk5Yac6ZO25rGH55CG5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4HuivuuWuieWfuumHkeeuoeeQhuaciemZkOWFrOWPuB7or7rlvrfln7rph5HnrqHnkIbmnInpmZDlhazlj7ge6bmP5Y2O5Z+66YeR566h55CG5pyJ6ZmQ5YWs5Y+4Hum5j+aJrOWfuumHkeeuoeeQhuaciemZkOWFrOWPuB7lubPlronln7rph5HnrqHnkIbmnInpmZDlhazlj7gk5bmz5a6J5L+h5omY5oqV6LWE5pyJ6ZmQ6LSj5Lu75YWs5Y+4JOa1pumTtuWuieebm+WfuumHkeeuoeeQhuaciemZkOWFrOWPuCTliY3mtbflvIDmupDln7rph5HnrqHnkIbmnInpmZDlhazlj7ge6J6N6YCa5Z+66YeR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Z2dnZ2dnZ2dnZ2dnZ2dnZ2dkZAIIDxBkEBUCEC0t5oqV6LWE57uE5ZCILS0P55m75b2V5ZCO5Y+v55SoFQIAABQrAwJnZ2RkAgkPEGQQFQIQLS3op4Llr5/liJfooagtLQ/nmbvlvZXlkI7lj6/nlKgVAgAAFCsDAmdnZGQCDA8PFgYfAwUG5b+r54WnHghDc3NDbGFzcwUGYWN0aXZlHgRfIVNCAgJkZAINDw8WBh8DBQ/kuJrnu6nlkozpo47pmakfCGUfCQICZGQCDg8PFgYfAwUM5oqV6LWE57uE5ZCIHwhlHwkCAmRkAg8PDxYGHwMFDOi0reS5sOS/oeaBrx8IZR8JAgJkZAISDw8WAh8DBQQ5NjUwZGQCEw8PFgYeC1JlY29yZGNvdW50ArJLHghQYWdlU2l6ZQIZHhBDdXJyZW50UGFnZUluZGV4AgVkZAIUDxBkZBYBZmQYAgUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFj8FHWN0bDAwJGNwaE1haW4kY2JsU3RhclJhdGluZyQwBR1jdGwwMCRjcGhNYWluJGNibFN0YXJSYXRpbmckMQUdY3RsMDAkY3BoTWFpbiRjYmxTdGFyUmF0aW5nJDEFHmN0bDAwJGNwaE1haW4kY2JsU3RhclJhdGluZzUkMAUeY3RsMDAkY3BoTWFpbiRjYmxTdGFyUmF0aW5nNSQxBR5jdGwwMCRjcGhNYWluJGNibFN0YXJSYXRpbmc1JDEFGGN0bDAwJGNwaE1haW4kY2JsR3JvdXAkMAUYY3RsMDAkY3BoTWFpbiRjYmxHcm91cCQxBRhjdGwwMCRjcGhNYWluJGNibEdyb3VwJDIFGGN0bDAwJGNwaE1haW4kY2JsR3JvdXAkMwUYY3RsMDAkY3BoTWFpbiRjYmxHcm91cCQzBRtjdGwwMCRjcGhNYWluJGNibENhdGVnb3J5JDAFG2N0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkMQUbY3RsMDAkY3BoTWFpbiRjYmxDYXRlZ29yeSQyBRtjdGwwMCRjcGhNYWluJGNibENhdGVnb3J5JDMFG2N0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkNAUbY3RsMDAkY3BoTWFpbiRjYmxDYXRlZ29yeSQ1BRtjdGwwMCRjcGhNYWluJGNibENhdGVnb3J5JDYFG2N0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkNwUbY3RsMDAkY3BoTWFpbiRjYmxDYXRlZ29yeSQ4BRtjdGwwMCRjcGhNYWluJGNibENhdGVnb3J5JDkFHGN0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkMTAFHGN0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkMTEFHGN0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkMTIFHGN0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkMTMFHGN0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkMTQFHGN0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkMTUFHGN0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkMTYFHGN0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkMTcFHGN0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkMTgFHGN0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkMTkFHGN0bDAwJGNwaE1haW4kY2JsQ2F0ZWdvcnkkMTkFGGN0bDAwJGNwaE1haW4kY2JsTGV2ZWwkMAUYY3RsMDAkY3BoTWFpbiRjYmxMZXZlbCQxBRhjdGwwMCRjcGhNYWluJGNibExldmVsJDIFGGN0bDAwJGNwaE1haW4kY2JsTGV2ZWwkMwUYY3RsMDAkY3BoTWFpbiRjYmxMZXZlbCQzBStjdGwwMCRjcGhNYWluJGdyaWRSZXN1bHQkY3RsMDEkaW1nU29ydEFycm93BSZjdGwwMCRjcGhNYWluJGdyaWRSZXN1bHQkY3RsMDIkY2hrRnVuZAUmY3RsMDAkY3BoTWFpbiRncmlkUmVzdWx0JGN0bDAzJGNoa0Z1bmQFJmN0bDAwJGNwaE1haW4kZ3JpZFJlc3VsdCRjdGwwNCRjaGtGdW5kBSZjdGwwMCRjcGhNYWluJGdyaWRSZXN1bHQkY3RsMDUkY2hrRnVuZAUmY3RsMDAkY3BoTWFpbiRncmlkUmVzdWx0JGN0bDA2JGNoa0Z1bmQFJmN0bDAwJGNwaE1haW4kZ3JpZFJlc3VsdCRjdGwwNyRjaGtGdW5kBSZjdGwwMCRjcGhNYWluJGdyaWRSZXN1bHQkY3RsMDgkY2hrRnVuZAUmY3RsMDAkY3BoTWFpbiRncmlkUmVzdWx0JGN0bDA5JGNoa0Z1bmQFJmN0bDAwJGNwaE1haW4kZ3JpZFJlc3VsdCRjdGwxMCRjaGtGdW5kBSZjdGwwMCRjcGhNYWluJGdyaWRSZXN1bHQkY3RsMTEkY2hrRnVuZAUmY3RsMDAkY3BoTWFpbiRncmlkUmVzdWx0JGN0bDEyJGNoa0Z1bmQFJmN0bDAwJGNwaE1haW4kZ3JpZFJlc3VsdCRjdGwxMyRjaGtGdW5kBSZjdGwwMCRjcGhNYWluJGdyaWRSZXN1bHQkY3RsMTQkY2hrRnVuZAUmY3RsMDAkY3BoTWFpbiRncmlkUmVzdWx0JGN0bDE1JGNoa0Z1bmQFJmN0bDAwJGNwaE1haW4kZ3JpZFJlc3VsdCRjdGwxNiRjaGtGdW5kBSZjdGwwMCRjcGhNYWluJGdyaWRSZXN1bHQkY3RsMTckY2hrRnVuZAUmY3RsMDAkY3BoTWFpbiRncmlkUmVzdWx0JGN0bDE4JGNoa0Z1bmQFJmN0bDAwJGNwaE1haW4kZ3JpZFJlc3VsdCRjdGwxOSRjaGtGdW5kBSZjdGwwMCRjcGhNYWluJGdyaWRSZXN1bHQkY3RsMjAkY2hrRnVuZAUmY3RsMDAkY3BoTWFpbiRncmlkUmVzdWx0JGN0bDIxJGNoa0Z1bmQFJmN0bDAwJGNwaE1haW4kZ3JpZFJlc3VsdCRjdGwyMiRjaGtGdW5kBSZjdGwwMCRjcGhNYWluJGdyaWRSZXN1bHQkY3RsMjMkY2hrRnVuZAUmY3RsMDAkY3BoTWFpbiRncmlkUmVzdWx0JGN0bDI0JGNoa0Z1bmQFJmN0bDAwJGNwaE1haW4kZ3JpZFJlc3VsdCRjdGwyNSRjaGtGdW5kBSZjdGwwMCRjcGhNYWluJGdyaWRSZXN1bHQkY3RsMjYkY2hrRnVuZAUYY3RsMDAkY3BoTWFpbiRncmlkUmVzdWx0DzwrAAoBCAIBZDMH+mZgnWlNFdr0bYTefSbvlZXo',
                '__EVENTVALIDATION': '/wEW6gECmoqgoQQCn7zM0gcCoLzM0gcCs7y4qQoCs7y0qQoC7PrGyggC7PrapQEC7PrugAoC7PqC3AICqvnIgwECxeLmmAsC9KaN2QwCj5Cr7gYClp7A2AkCsYfe7QMC4MuErgUC+7Siww8CgsO3rQICnazVwgwCxeKmywYCxeK6pg8CxeLOgQgCxeLiXALF4va3CQLF4oqTAgLF4p7uCgLF4rLJAwLF4sakDALF4tr/BALF4OKECgLF4M6pAQLF4Iq7CwLF4PbfAgKFtqecDQLO0rmMBwKgmNKlBgKoiqG4AwKpipm4AwLw36HmBALNk4OlBQLctuL4AgLDk4ulBQLCk4ulBQLJ0p2MBwLI0q2MBwLt+5O5CQKV5c+SCQLs+4e5CQLL0qWMBwLJ0rmMBwLluPnSDwLEoeDTCALI0qGMBwLw3+nlBALftpb4AgLnuP3SDwKV5aOTCQKgmKKmBgK6oYTTCAKV5cuSCQLnuO3SDwLi+/u5CQKpiqm4AwLI0rGMBwLkuOnSDwKuiqm4AwLt+5u5CQLy36XmBAKgmKqmBgLkuPHSDwLL0p2MBwLnuOHSDwLz36HmBALnuOnSDwLw3+3lBALCk8elBQKU5aOTCQLz3/nlBALNk/ulBQKhmIqmBgK6obDTCALftpr4AgKuiqG4AwLfts74AgLI0p2MBwKhmKKmBgLftuL4AgLCk5OlBQLmuN3SDwKpiqG4AwLnuPnSDwLx38XlBALI0qWMBwLI0rmMBwKgmKamBgLJ0qmMBwLJ0pmMBwKjmIqmBgLDk5elBQLCk+elBQKhmI6mBgLL0pmMBwK7oYzTCAK7oYDTCALi+5u5CQKpioW4AwLmuOXSDwLftpL4AgKU5YeTCQKU5dOSCQLDk5OlBQLFoYzTCALz3/3lBALFoYDTCAKuirm4AwK6oezTCALnuPXSDwLw3/nlBAKpirm4AwLmuNnSDwLkuO3SDwLFobjTCALetuL4AgKU5aeTCQLI0r2MBwLw3/XlBAKU5deSCQLluP3SDwLEoajTCALets74AgLt+5+5CQLw36XmBAKhmK6mBgKmmKqmBgLZts74AgLFoeDTCALFoYTTCAK6obTTCALt+/+5CQLs+4O5CQLJ0r2MBwKoipm4AwLetub4AgKoiuW4AwLAk+elBQKU5duSCQLI0qmMBwKK5aeTCQKuirW4AwKV5YeTCQLCk5ulBQLJ0rGMBwKuir24AwKU5YOTCQKX5YeTCQKjmNalBgLetsL4AgLnuN3SDwLw3/3lBALZtsL4AgKpir24AwLs+/+5CQLCk5+lBQKU5c+SCQKgmI6mBgLz36XmBALy36HmBALi+/+5CQLFobDTCAKV5YOTCQLi+4+5CQLnuPHSDwLi+4u5CQKgmIqmBgLw38HlBALi+5e5CQLz38XlBAKhmNKlBgLkuNnSDwKjmI6mBgLt+/u5CQLAk5ulBQLkuPXSDwKpirG4AwK6obzTCALNk8elBQLx38HlBAKEiMLTDAKEiMLTDAKQ18zyAwKQ18zyAwLF7Je2DgKvw/+HAQKWjpmUAwLdt+TKBQL10KDSBgL+xcmpAQKIv62ECAKe2tCSDwLF05trAtTm4bgNAvX32OQPAv/S5cQBAtj00aMGAtrrjewDArmenJAPAqGm8ogMAsrQmI0DAsrQ9PACAsrQkEkCytCMKwLK0KiVAgLK0MT3AQLK0OD4DwLK0NzSDwLd3MDRAQLd3LyzAQLd3JiNAwLd3PTwAgLd3JBJAt3cjCsC3dyolQIC3dzE9wEC3dzg+A8C3dzc0g8C3OTA0QEC3OS8swEC3OSYjQMC3OT08AIC3OSQSQLc5IwrAtzkqJUCAvv2wKwBAvWZlsENIFM5mRkddY8+lZFeVu14vHjG10o=',
            }

            # post访问
            for url in self.start_urls:
                yield scrapy.FormRequest(url=url, formdata=data, callback=self.page_next)

    def page_next(self, response):

        hrefs = response.xpath('//*[@id="ctl00_cphMain_gridResult"]//tr/td[3]/a/@href').extract()
        for href in hrefs:
            url = "http://cn.morningstar.com{}".format(href)

            yield response.follow(url=url, callback=self.base)

    def base(self, response):
        code = response.xpath('//*[@id="qt_fund"]/span[1]/text()').extract()
        base = response.xpath('//*[@id="qt_base"]//img[@class="sb"]/@src').extract()

        classify = response.xpath('//*[@id="qt_base"]/ul[@class="info"]/li[1]/span/text()').extract()
        setupday = response.xpath('//*[@id="qt_base"]/ul[@class="info"]/li[2]/span/text()').extract()
        openday = response.xpath('//*[@id="qt_base"]/ul[@class="info"]/li[3]/span/text()').extract()
        isBuy = response.xpath('//*[@id="qt_base"]/ul[@class="info"]/li[5]/span/text()').extract()
        rede = response.xpath('//*[@id="qt_base"]/ul[@class="info"]/li[6]/span/text()').extract()
        total = response.xpath('//*[@id="qt_base"]/ul[@class="info"]/li[8]/span/text()').extract()
        Mini = response.xpath('//*[@id="qt_base"]/ul[@class="info"]/li[9]/span/text()').extract()
        front = response.xpath('//*[@id="qt_base"]/ul[@class="info"]/li[11]/span/text()').extract()

        item = MorningstarRateItem()

        item['code'] = code
        item['base'] = base
        item['classify'] = classify
        item['setupday'] = setupday
        item['openday'] = openday
        item['isBuy'] = isBuy
        item['rede'] = rede
        item['total'] = total
        item['Mini'] = Mini
        item['front'] = front

        yield item

